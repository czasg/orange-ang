---
title: Map
slug: /basics/map
---

import FullScreenImage from '@site/src/components/FullScreenImage';
import BrowserWindow from '@site/src/components/BrowserWindow';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<!--package-->

在 Go 中，Map 是一个无序的键值对集合。它由key-value键值对组成，每一个键key都是唯一的，且每一个键key都对应一个值value。

Map 的最大的特点就是高效。无论内部包含多少数据，Map都可以非常高效对数据进行操作。

一个 Map 的基本语法结构为：
```go
map[数据类型]数据类型
```

我们可以看到 Map 包含三个部分：
- map关键字
- key数据类型
- value数据类型

示例如下：
```go
map[string]string
map[string]int
map[int]int
```

## 初始化

初始化 Map 的方式有多种，包括：
- 直接声明
- make

### 直接声明
在 Go 中，可以通过直接声明的方式初始化一个 Map。

```go title="声明空map"
kv := map[string]string{}
```

```go title="声明非空map"
kv := map[string]string{
    "k1": "v1",
    "k2": "v2",
}
```

### make
除了直接声明之外，还可以使用`make`指定初始容量。

```go title="指定初始容量"
kv := make(map[string]string, 100)
```

map拥有扩容因子，因此当数量达到一定阈值时，就会触发扩容。因此通过make可以指定初始容量，避免高频的触发扩容。


## Map操作

### 插入
在 Go 中，对 map 进行插入采用如下方式：

```go
kv := map[string]string{}
kv["k1"] = "v1"
kv["k2"] = "v2"
fmt.Println(len(kv)) // 2
```

### 删除
在 Go 中，对 map 进行删除使用 delete 函数。

```go
kv := map[string]string{
    "k1": "v1",
    "k2": "v2",
}
delete(kv, "k1") // 删除k1
delete(kv, "不存在的值") // 允许删除不存在的值
fmt.Println(len(kv)) // 1
```

### 查找
在 Go 中，使用 map 进行查找时需要注意其返回值。如果值存在，则返回对应的值，如果值不存在，则仍然返回该值对应的零值。

这就意味着，无论无法，map 始终会返回值给你。为了更好的区别值是否存在，map支持返回第二个参数，这是一个布尔类型的值，用于判断该值是否存在。

```go title="返回一个值"
kv := map[string]string{
    "k1": "v1",
    "k2": "v2",
}
v1 := kv["k1"]
fmt,Println(v1) // "v1"
v2 := kv["不存在的值"]
fmt,Println(v2) // ""
```

```go title="返回两个值"
kv := map[string]string{
    "k1": "v1",
    "k2": "v2",
}
v1, ok := kv["k1"]
fmt,Println(v1, ok) // "v1", true
v2, ok := kv["不存在的值"]
fmt,Println(v2, ok) // "", false
```


## 进阶-Map查找原理
map底层是基于哈希表实现的。

一次完成的查找过程包括：
1.对key进行算哈希
2.用哈希对数组长度进行取余，获取数组下标
3.在数组对应下标查找元素
4.当存在哈希冲突时，在对应的哈希桶链表查找元素

当进行操作时，首先对键值对算哈希，然后用计算出来的哈希值对哈希数组长度进行取余。从而一个键值对可以唯一命中一个哈希桶。

当不同的键值命中同一个哈希桶时，这种就叫做哈希冲突。此时可以通过拉出一个链表的方式存储冲突的键值对数据。


## 进阶-Map扩容原理
map 扩容就是申请一个更大的哈希表，然后将当前哈希表的元素迁移到新的哈希表中。

这个过程会涉及到重新计算key哈希，因此也叫rehash。

