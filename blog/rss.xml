<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>橙子昂的小站 Blog</title>
        <link>https://czasg.github.io/orange-ang/blog</link>
        <description>橙子昂的小站 Blog</description>
        <lastBuildDate>Tue, 30 Apr 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[云原生技术探索]]></title>
            <link>https://czasg.github.io/orange-ang/blog/云原生技术探索</link>
            <guid>https://czasg.github.io/orange-ang/blog/云原生技术探索</guid>
            <pubDate>Tue, 30 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[如果在10年前，有人给你做 容器、云原生，Serverless的分享，你肯定会以为这个人是个大忽悠。特别是如果你在当时就有了一定的知识积累，你更可能觉得这些技术，都只不过是“新瓶装旧酒”，不值得过度关注。]]></description>
            <content:encoded><![CDATA[<p>如果在10年前，有人给你做 容器、云原生，Serverless的分享，你肯定会以为这个人是个大忽悠。特别是如果你在当时就有了一定的知识积累，你更可能觉得这些技术，都只不过是“新瓶装旧酒”，不值得过度关注。</p>
<p>但技术的演进，往往就是从 <strong>“看不到 / 看不起” =&gt; "看不懂" =&gt; "跟不上"</strong>。</p>
<p>但无论现阶段的我们处于那种状态，在当前容器化时代，掌握容器引擎、容器编排管理工具的使用，了解其基础概念与原理，这都将有助于日常工作的开展。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1云计算演进史">1.云计算演进史<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#1%E4%BA%91%E8%AE%A1%E7%AE%97%E6%BC%94%E8%BF%9B%E5%8F%B2" class="hash-link" aria-label="1.云计算演进史的直接链接" title="1.云计算演进史的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>云计算</div><div class="admonitionContent_BuS1"><p>云计算是通过互联网提供计算资源与服务，用户按需获取，无需拥有硬件，实现灵活、经济高效的计算模式，而无需在本地拥有和维护硬件和软件。</p><p>简单来说：云计算是一种服务模式，它通过互联网出租云服务器。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>云原生</div><div class="admonitionContent_BuS1"><p>CNCF（Cloud Native Computing Foundation，云原生计算基金会）对云原生的定义：云原生技术是有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用技术。其代表技术包括：容器、服务网格、微服务、不可变基础设施和声明式 API 等。</p><p>简单来说：云原生是一种软件技术架构，在云计算的基础上，实现了：</p><ul>
<li>应用容器化</li>
<li>容器编排化（横向扩容、滚动升级、负载均衡、容灾备份等）</li>
</ul></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11虚拟化技术落地">1.1.虚拟化技术落地<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#11%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E8%90%BD%E5%9C%B0" class="hash-link" aria-label="1.1.虚拟化技术落地的直接链接" title="1.1.虚拟化技术落地的直接链接">​</a></h3>
<p>虚拟化技术是一种资源管理技术，在各种实体资源（CPU、内存、网络、存储等）之上构建一个逻辑层，从而摆脱物理限制的约束，提高物理资源的利用率。</p>
<ul>
<li>2001 年 VMware 发布 VMware ESX。它可以在同一台物理机上运行多个虚拟机。这意味着虚拟化技术真正得到了落地，服务器的数量将下降，与之对应的是，服务器资源将得到更加充分的利用。 <br></li>
<li>2006 年 AWS 首创按时计费的方式租借服务器，揭开了云计算时代帷幕。 <br></li>
<li>2008 年 Alibaba 开始筹备阿里云，云计算逐渐成为计算机领域最令人关注的话题之一。 <br></li>
<li>2010 年 openstack 发布第一个开源版本，云计算正式进入开源时代。 <br></li>
</ul>
<p>小结：虚拟化技术 提高了 物理资源的利用率。极大的提升了硬件价值上限。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12容器化技术落地">1.2.容器化技术落地<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#12%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E8%90%BD%E5%9C%B0" class="hash-link" aria-label="1.2.容器化技术落地的直接链接" title="1.2.容器化技术落地的直接链接">​</a></h3>
<p>容器化技术同样也是一种资源管理技术，它是在复用系统内核的基础之上，对实体资源（网络、进程、存储等）进一步的构建一个逻辑层。因此相比对虚拟化技术，容器化技术隔离是不彻底的，但更轻量级。</p>
<ul>
<li>2013 年 docker 发布。容器在多数领域逐步替代 VM，云计算进入容器时代。 <br></li>
<li>2018 年 kubernetes 基本全面赢得容器编排市场的胜利，云计算进入 K8S 时代。 <br></li>
</ul>
<p>小结：容器化技术 建立在 虚拟化技术优势之上，不仅大幅提高了资源的利用率，还提供更轻量级的管理方式。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2云原生代表技术">2.云原生代表技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2%E4%BA%91%E5%8E%9F%E7%94%9F%EF%BF%BD%EF%BF%BD%E4%BB%A3%E8%A1%A8%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.云原生代表技术的直接链接" title="2.云原生代表技术的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21容器技术docker">2.1.容器技术（docker）<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#21%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker" class="hash-link" aria-label="2.1.容器技术（docker）的直接链接" title="2.1.容器技术（docker）的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="211什么场景下可以使用容器技术">2.1.1.什么场景下可以使用容器技术?<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#211%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF%E4%B8%8B%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.1.1.什么场景下可以使用容器技术?的直接链接" title="2.1.1.什么场景下可以使用容器技术?的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">某公司...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：服务是否可以直接部署在内部的虚拟机上</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：可以，但不建议，你们自己部署的服务，没有运维保障，容易背锅</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：可是我们之前公司都是部署在自己的虚拟机上</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：你可以把服务构建镜像，然后用容器去跑</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：没必要啊，我环境都配好了，直接跑不是一样的，性能还更好...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：那如果这台虚拟机有问题，你能确保服务快速恢复吗</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：可以，程序依赖都已经打包好了（jar / venv / static / bin），可以快速重新部署恢复</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：ojbk</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">... ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">某天，虚拟机裂开了，研发跑路，运维接坑...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">运维：完了，这叼毛 jar 怎么跑不起来，一堆飘红额...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">运维：完了，这叼毛 php 是跑起来了还是没跑起来...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">... ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上述场景，粗看是一个技术壁垒问题。本质应该还是一个管理问题（交接文档没有写清楚，部署说明没有介绍清楚等...）。 <br>
但是，这个案列又非常经典，因为技术壁垒导致的项目管理复杂度上升，是非常常见的。 <br>
特别是对一些交付源码的项目，这种项目往往高度依赖环境准备... <br></p>
<p>如果有一种技术，它可以定义一种通用的交付产物，消除研发、测试、运维、产品之间的强技术壁垒，并在整个项目生命周期内达成一种通用的“语言”。那这个技术，简直泰裤辣。</p>
<p>而 docker，就是这么一门技术。 <br>
它创新性的引入了镜像概念，重新定义了交付产物，让不同的服务之间，可以以近乎相似的方式进行维护。 <br>
也正是因为镜像的引入，彻底掀起了容器化的热潮~ <br></p>
<p>答案：除了不能用使用容器的场景，否则都推荐使用容器技术~</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="212一个简单的容器场景">2.1.2.一个简单的容器场景<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#212%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%B9%E5%99%A8%E5%9C%BA%E6%99%AF" class="hash-link" aria-label="2.1.2.一个简单的容器场景的直接链接" title="2.1.2.一个简单的容器场景的直接链接">​</a></h4>
<p>场景：前端编译后需要对外发布</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">1-编译镜像</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 镜像拉取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker pull nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 镜像模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> vim Dockerfile</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">1.</span><span class="token plain"> FROM nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3.</span><span class="token plain"> COPY </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">dist</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">share</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">html</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">4.</span><span class="token plain"> EXPOSE </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 编译镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker build </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">t harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">2-推送镜像</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 登录镜像仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker login harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 推送镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker push harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">3-运行容器</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 登录远程服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> ssh xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 拉取镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker pull harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">itd </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">p </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"> harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="213容器核心技术">2.1.3.容器核心技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#213%E5%AE%B9%E5%99%A8%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.1.3.容器核心技术的直接链接" title="2.1.3.容器核心技术的直接链接">​</a></h4>
<ul>
<li>cgroups：可以控制进程资源的使用。如：CPU、内存 等。</li>
<li>namespace：可以控制进程资源的隔离。如：网络、存储 等。</li>
<li>unionfs：可以将多个目录联合挂载到一个统一的目录。（可以简单认为是一种只读的软链接）</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="214docker核心概念">2.1.4.docker核心概念<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#214docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" class="hash-link" aria-label="2.1.4.docker核心概念的直接链接" title="2.1.4.docker核心概念的直接链接">​</a></h4>
<ul>
<li>镜像</li>
<li>网络</li>
<li>存储卷</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2141镜像">2.1.4.1.镜像<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2141%E9%95%9C%E5%83%8F" class="hash-link" aria-label="2.1.4.1.镜像的直接链接" title="2.1.4.1.镜像的直接链接">​</a></h5>
<p>镜像是构建和运行容器的基础。我们可以把镜像理解为一个只读的模板，或者是压缩包，它包含了运行一个应用程序所需要的所有内容：</p>
<ul>
<li>应用程序（源码/编译产物）</li>
<li>运行时环境</li>
<li>系统工具</li>
<li>三方库依赖</li>
<li>配置参数</li>
<li>... ...</li>
</ul>
<p>我们完全可以把镜像理解为一个独立且完整的应用程序包。</p>
<p>思考：镜像和之前所提到的交付产物有何区别。</p>
<p>镜像由一系列的层组成，每个层都代表着镜像的一部分。这些层在构建镜像时按照顺序添加，并且都是只读的，因此在构建相同层时可以复用，从而节省存储空间。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-f14d8b9ca62710bba57b811debcbfbe7.jpg" class="image_FkF6" alt="Image">
<p>自己构建一个镜像</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM ubuntu:15.04</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mkdir /workplace</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">echo -n &gt; /workplace/README.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-2-b693486394a9a9a6fd03b7aff62b0d49.png" class="image_FkF6" alt="Image">
<p>镜像最终会通过类似一种堆积木的方式呈现出来。从技术角度来讲，这是通过联合文件系统实现的。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-3-ac6868d010d30050e868d8c19a34827a.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2142网络">2.1.4.2.网络<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2142%E7%BD%91%E7%BB%9C" class="hash-link" aria-label="2.1.4.2.网络的直接链接" title="2.1.4.2.网络的直接链接">​</a></h5>
<p>在 docker 中，网络是一种用于容器间通信的机制。在同一个虚拟网络下，不同容器之间是可以相互访问的。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-c86471da8bec93f73ac0fb7b65615909.png" class="image_FkF6" alt="Image">
<p>为了确保容器所处网络环境隔离性，可以通过自定义虚拟网络来实现。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 创建网络network1和network2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container1 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network2中创建容器container2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container2 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network2 your_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-1-a1fa19a2353e36cec02fd16f591a7f2c.png" class="image_FkF6" alt="Image">
<p>为了进一步的实现网络资源共享，可以通过网络连接的方式，将多容器连接到某一个容器，从而复用指定容器的网络（IP）资源。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 创建网络network1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container1 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container2、container3，并连接到container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container2 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">container1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">container1 your_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-2-b2fc5b0dd4dc2389efc967e539696cf8.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2143存储卷">2.1.4.3.存储卷<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2143%E5%AD%98%E5%82%A8%E5%8D%B7" class="hash-link" aria-label="2.1.4.3.存储卷的直接链接" title="2.1.4.3.存储卷的直接链接">​</a></h5>
<p>在 docker 中，存储卷是一种特殊的文件目录或者文件，用于在容器和宿主机之间实现持久化存储数据。</p>
<p>和镜像层的只读层不同的是，存储卷拥有：</p>
<ul>
<li>持久化的</li>
<li>共享的</li>
<li>独立于容器生命周期的</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># -v</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run -v /host/path:/container/path my_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># --mount</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run --mount type=bind,source=/host/path,target=/container/path my_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22容器编排技术">2.2.容器编排技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#22%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.2.容器编排技术的直接链接" title="2.2.容器编排技术的直接链接">​</a></h3>
<p>容器编排技术本质就是管理容器的技术。</p>
<p>为什么需要使用容器编排技术，容器编排和容器之间的关系，就类似 虚拟机 和 openstack 之间的关系，对于大型容器集群，需要有便捷的工具来管理。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="221k8s集群架构">2.2.1.k8s集群架构<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#221k8s%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84" class="hash-link" aria-label="2.2.1.k8s集群架构的直接链接" title="2.2.1.k8s集群架构的直接链接">​</a></h4>
<p>k8s 就是目前市面上最成功的容器编排实现标准。</p>
<p>它是经典的主从架构，分别是：contaol-plane 和 node。</p>
<table><thead><tr><th>归属</th><th>服务</th><th>说明</th></tr></thead><tbody><tr><td>control-plane</td><td>kube-api-server</td><td>k8s 网关服务，用于接收所有 k8s 请求并进行处理</td></tr><tr><td>control-plane</td><td>kube-controller-manager</td><td>k8s 控制器，负责监控系统状态与变化，确保目标状态符合期望状态</td></tr><tr><td>control-plane</td><td>kube-scheduler</td><td>k8s 调度器，统筹所有节点资源，负责和节点交互，并基于一定的规则（亲和性、反亲和性）进行资源调度</td></tr><tr><td>control-plane</td><td>etcd</td><td>分布式键值对存储系统</td></tr><tr><td>node</td><td>kubectl</td><td>节点上的代理服务，负责该节点的运行状态、容器管理等</td></tr><tr><td>node</td><td>kube-proxy</td><td>维护该节点上的网络规则，以确保服务能够被正确发现</td></tr><tr><td>node</td><td>container-runtime</td><td>容器引擎，负责容器管理，包括：创建、删除等</td></tr><tr><td>node</td><td>pod</td><td>k8s 集群中最小的可部署单元。也是集群中单服务的高层抽象</td></tr></tbody></table>
<p>我们可以通过熟悉 k8s 的交互流程来熟悉 k8s 架构。下面演示一次完整的 <code>kubectl apply -f deploy.yaml</code> 执行流程。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-96f8760b04718c0e5d8d3ec402761a71.png" class="image_FkF6" alt="Image">
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="322pod详解">3.2.2.pod详解<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#322pod%E8%AF%A6%E8%A7%A3" class="hash-link" aria-label="3.2.2.pod详解的直接链接" title="3.2.2.pod详解的直接链接">​</a></h4>
<p>如果 k8s 是以 docker 作为容器引擎，那么我们完全可以在本地通过 docker 模拟出 pod 的行为。</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">DockerCompose</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'3'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"80:80"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<p>对于简单场景下的单容器 Pod 来说，k8s 和 docker 部署的服务几乎没有任何区别。</p>
<p>但是，在多容器场景下，Pod 对外表现出来的更像是一个整体，因为他们对外只有一个 IP ~</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">DockerCompose</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">CMD</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'3'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"80:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"8080:8080"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker create network pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name pause </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=pod pause</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name nginx </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">pause nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">pause server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<p>对于这种场景下，我们可以通过容器连接来实现，但问题是，以谁为根容器作为被其他容器连接的对象呢？</p>
<p>PS：根容器的特点：稳定</p>
<p>Pod 详解</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-2-42b2d98c2371440a8c6ea8171cb5a094.png" class="image_FkF6" alt="Image">
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">initContainers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 初始化容器列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">'sh'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'-c'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'echo Initializing... &amp;&amp; sleep 5'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 执行初始化操作，输出消息并休眠5秒钟</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 主容器列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">lifecycle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义容器的生命周期钩子</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">postStart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">exec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"/bin/sh"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"-c"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"echo Container started."</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 在容器启动后执行的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">preStop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">exec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"/bin/sh"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"-c"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"echo Container stopping..."</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 在容器停止前执行的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 就绪性检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器启动后等待5秒再进行第一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 间隔5秒进行一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 存活性检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器启动后等待10秒再进行第一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 间隔5秒进行一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器的挂载点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /usr/share/nginx/html  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 将 emptyDir 卷挂载到容器的 /usr/share/nginx/html 路径，实现数据共享</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 卷列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">emptyDir</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 空目录卷，用于在 init-container 和主容器之间共享数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Always  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器的重启策略，始终重启</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="323常用资源对象介绍">3.2.3.常用资源对象介绍<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#323%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E4%BB%8B%E7%BB%8D" class="hash-link" aria-label="3.2.3.常用资源对象介绍的直接链接" title="3.2.3.常用资源对象介绍的直接链接">​</a></h4>
<p>在 k8s 集群中，一般不直接使用 pod。因为 pod 的生命周期被视为短暂的~</p>
<p>为了更好的去管理集群中的 pod 应用，k8s 集群引入了其他的资源对象。</p>
<table><thead><tr><th>资源对象</th><th>说明</th><th>其他</th></tr></thead><tbody><tr><td>Deployment</td><td></td><td></td></tr><tr><td>Service</td><td>一组服务的抽象</td><td>dns</td></tr><tr><td>Ingress</td><td>路由规则集，用于控制集群外部流量导入</td><td>nginx</td></tr><tr><td>ConfigMap</td><td>配置中心</td><td></td></tr></tbody></table>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-3-27bba66d4a2ccb9dd293876fdda6c2a6.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3231configmap">3.2.3.1.configmap<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3231configmap" class="hash-link" aria-label="3.2.3.1.configmap的直接链接" title="3.2.3.1.configmap的直接链接">​</a></h5>
<p>configmap 是键值对配置，可以以环境变量或者文件的形式注入进 pod。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">LOG_LEVEL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">LOG_FORMAT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">NGINX_CONFIG_FILE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location / </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            index  index.html index.htm;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location = /50x.html </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">envFrom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 指定环境变量来源于configMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">configMapRef</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 直接在pod中指定需要哪些环境变量，此优先级最高</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"LOG_LEVEL"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"error"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"LOG_FORMAT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"text"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 通过文件的形式注入pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /etc/nginx/conf.d/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">configMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 指定存储卷类型为configMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">defaultMode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">420</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">items</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> NGINX_CONFIG_FILE </span><span class="token comment" style="color:rgb(106, 153, 85)"># 仅取出其中某个key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> default.conf</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3232ingress">3.2.3.2.ingress<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3232ingress" class="hash-link" aria-label="3.2.3.2.ingress的直接链接" title="3.2.3.2.ingress的直接链接">​</a></h5>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx.hsk8s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">dev.avlyun.org</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /download</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /api/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /api/v2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3233service">3.2.3.3.service<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3233service" class="hash-link" aria-label="3.2.3.3.service的直接链接" title="3.2.3.3.service的直接链接">​</a></h5>
<p>service 是一组服务的抽象，可用于 DNS 解析，其解析的结果，是对应 Pod 的 IP 集合。</p>
<p>因此，我们完全可以把 service 当做一个合法的域名来使用。下面通过执行 <code>curl nginx.fos-2-dev</code> 来展示 service 的魅力~</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/service-8dab6971183dc9337acef1d22f9af576.png" class="image_FkF6" alt="Image">
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义一组服务中的端口转发</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义一组服务（pod）标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ClusterIP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>问题：在 k8s 集群中，到底应该如何访问其他服务？</p>
<p>答案：应该通过 service.namespace 来访问，直接端到端的跑流量，而不用走 ingress 转发。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3231deployment">3.2.3.1.deployment<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3231deployment" class="hash-link" aria-label="3.2.3.1.deployment的直接链接" title="3.2.3.1.deployment的直接链接">​</a></h5>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Deployment/RollingUpdate</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Deployment/Recreate</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 副本数为 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 50%  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 允许的最大超出副本数，支持整数，也支持百分比</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 允许的最大不可用副本数，支持整数，也支持百分比</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> RollingUpdate  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用滚动升级策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用最新版本的 Nginx 镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器监听端口 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 副本数为 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Recreate </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用重建升级策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用最新版本的 Nginx 镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器监听端口 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4答疑">4.答疑<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#4%E7%AD%94%E7%96%91" class="hash-link" aria-label="4.答疑的直接链接" title="4.答疑的直接链接">​</a></h2>
<p>... ...</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>待分类</category>
        </item>
        <item>
            <title><![CDATA[结构化思维实战-深度思考模型]]></title>
            <link>https://czasg.github.io/orange-ang/blog/structure-mind-deep-thinking</link>
            <guid>https://czasg.github.io/orange-ang/blog/structure-mind-deep-thinking</guid>
            <pubDate>Mon, 25 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[摘要在此处]]></description>
            <content:encoded><![CDATA[<p>摘要在此处</p>
<p>正文在此处</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>结构化思维实战</category>
        </item>
        <item>
            <title><![CDATA[结构化思维实战-鼓励赋能模型]]></title>
            <link>https://czasg.github.io/orange-ang/blog/structure-mind-encourage-model</link>
            <guid>https://czasg.github.io/orange-ang/blog/structure-mind-encourage-model</guid>
            <pubDate>Mon, 25 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[摘要在此处]]></description>
            <content:encoded><![CDATA[<p>摘要在此处</p>
<p>正文在此处</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>结构化思维实战</category>
        </item>
        <item>
            <title><![CDATA[docusaurus 搭建 github 站点教程]]></title>
            <link>https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages</link>
            <guid>https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages</guid>
            <pubDate>Fri, 22 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[本文记录如何基于 docusaurus 从0到1搭建 github 免费个人站点，并通过 github-actions 实现自动部署。]]></description>
            <content:encoded><![CDATA[<p>本文记录如何基于 docusaurus 从0到1搭建 github 免费个人站点，并通过 github-actions 实现自动部署。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化仓库">初始化仓库<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%93%E5%BA%93" class="hash-link" aria-label="初始化仓库的直接链接" title="初始化仓库的直接链接">​</a></h2>
<p>进入<a href="https://github.com/new" target="_blank" rel="noopener noreferrer">github仓库创建页面</a>，我们创建一个全新的空白仓库，项目名命名为 <code>myblog</code>。</p>
<p>接着，我们新建 gh-pages 分支，并修改 pages 配置，将部署信息指向我们新建的 gh-pages 分支。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-codespaces">创建 codespaces<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9B%E5%BB%BA-codespaces" class="hash-link" aria-label="创建 codespaces的直接链接" title="创建 codespaces的直接链接">​</a></h2>
<p>codespaces 是浏览器版的 vscode，方便我们在线进行服务搭建。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化-docusaurus-项目">初始化 docusaurus 项目<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96-docusaurus-%E9%A1%B9%E7%9B%AE" class="hash-link" aria-label="初始化 docusaurus 项目的直接链接" title="初始化 docusaurus 项目的直接链接">​</a></h2>
<p>在这里，我们直接使用 codespaces 进行项目初始化。codespaces 是浏览器版的 vscode，方便我们在线进行服务搭建。</p>
<p>执行命令行：</p>
<ul>
<li><code>npx create-docusaurus@latest myblog classic</code>：初始化一个 myblog 的 docusaurus 项目</li>
<li><code>mv ./myblog/* ./myblog/.gitignore .</code>：将 myblog 目录下的所有文件移动到当前目录</li>
<li><code>rm -rf myblog</code></li>
</ul>
<p>修改 <code>docusaurus.config.js</code> 文件</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置部署公钥与密钥">配置部署公钥与密钥<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%E5%85%AC%E9%92%A5%E4%B8%8E%E5%AF%86%E9%92%A5" class="hash-link" aria-label="配置部署公钥与密钥的直接链接" title="配置部署公钥与密钥的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="适配-workflow-文件">适配 workflow 文件<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%80%82%E9%85%8D-workflow-%E6%96%87%E4%BB%B6" class="hash-link" aria-label="适配 workflow 文件的直接链接" title="适配 workflow 文件的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="提交代码">提交代码<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="提交代码的直接链接" title="提交代码的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置-gh-pages">配置 gh-pages<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%85%8D%E7%BD%AE-gh-pages" class="hash-link" aria-label="配置 gh-pages的直接链接" title="配置 gh-pages的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化-action-环境">初始化 action 环境<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96-action-%E7%8E%AF%E5%A2%83" class="hash-link" aria-label="初始化 action 环境的直接链接" title="初始化 action 环境的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建-docusaurus-项目">新建 docusaurus 项目<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%96%B0%E5%BB%BA-docusaurus-%E9%A1%B9%E7%9B%AE" class="hash-link" aria-label="新建 docusaurus 项目的直接链接" title="新建 docusaurus 项目的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化">初始化<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="初始化的直接链接" title="初始化的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="搭建-github-actions">搭建 Github Actions<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%90%AD%E5%BB%BA-github-actions" class="hash-link" aria-label="搭建 Github Actions的直接链接" title="搭建 Github Actions的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新仓库尝试自动部署">更新仓库，尝试自动部署<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%9B%B4%E6%96%B0%E4%BB%93%E5%BA%93%E5%B0%9D%E8%AF%95%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2" class="hash-link" aria-label="更新仓库，尝试自动部署的直接链接" title="更新仓库，尝试自动部署的直接链接">​</a></h2>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>教程</category>
        </item>
    </channel>
</rss>